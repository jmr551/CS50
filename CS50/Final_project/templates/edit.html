<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Edit Image</title>
    </head>
    <body>
        <h1>Edit your image</h1>
        <div>
            <h2>Original Image</h2>
            <img id="originalImage" src="{{ url_for('static', filename=image_path) }}" alt="Image to be edited" style="max-width:500px;">
        </div>

        <div>
            <h2>Modified Image</h2>
            <canvas id="canvas" style="max-width:500px;"></canvas>
        </div>

        <div>
            <label for="brightness">Brightness</label>
            <input type="range" id="brightness" name="brightness" min="0" max="200" value="100" onchange="updateImage()">
        </div>

        <div>
            <label for="contrast">Contrast:</label>
            <input type="range" id="contrast" name="contrast" min="0" max="200" value="100" onchange="updateImage()">
        </div>

        <div>
            <label for="saturation">Saturation:</label>
            <input type="range" id="saturation" name="saturation" min="0" max="200" value="100" onchange="updateImage()">
        </div>

        <div>
            <label for="blur">Blur:</label>
            <input type="range" id="blur" name="blur" min="0" max="10" value="0" onchange="updateImage()">
        </div>


        <script>
            window.onload = function() {
                var img = document.getElementById('originalImage');
                // Esta verificación asegura que si la imagen ya está cargada, se dibuja inmediatamente.
                if (img.complete || img.naturalHeight !== 0) {
                    drawImage(img);
                } else {
                    img.onload = function() {
                        drawImage(img);
                    };
                }
            };
            function drawImage(img) {
                var canvas = document.getElementById('canvas');
                var ctx = canvas.getContext('2d');
                canvas.width = img.naturalWidth;
                canvas.height = img.naturalHeight;
                // Limpia el canvas y dibuja la imagen base.
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            }
            function updateImage() {
                var img = document.getElementById('originalImage');
                var brightness = document.getElementById('brightness').value;
                var contrast = document.getElementById('contrast').value;
                var saturation = document.getElementById('saturation').value;
                var blur = document.getElementById('blur').value;
                var canvas = document.getElementById('canvas');
                var ctx = canvas.getContext('2d');
                // Limpia el canvas y establece los filtros.
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.filter = `brightness(${brightness}%) contrast(${contrast}%) saturation(${saturation}%) blur(${blur}px)`;
                // Redibuja la imagen con los filtros aplicados.
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            }
        </script>
    </body>
</html>


